# Проект по Базам Данных: Получение и Анализ Вакансий с hh.ru

## Описание проекта

Данный проект предназначен для получения данных о компаниях и вакансиях с сайта [hh.ru](https://hh.ru), их хранения в базе данных PostgreSQL и взаимодействия с этими данными через консольный интерфейс. Проект демонстрирует навыки работы с API, базами данных и консольным интерфейсом на языке Python.

## Функциональные возможности

- **Получение вакансий**: Автоматический сбор вакансий для 10 выбранных компаний с использованием публичного API hh.ru.
- **Хранение данных**: Сохранение информации о компаниях и вакансиях в базе данных PostgreSQL.
- **Взаимодействие с базой данных**: Класс `DBManager` предоставляет методы для работы с данными в БД.
- **Консольный интерфейс**: Пользователь может взаимодействовать с программой через меню, выполняя различные операции:
  - Просмотр списка компаний и количества вакансий у каждой.
  - Просмотр всех вакансий с подробной информацией.
  - Вычисление средней зарплаты по всем вакансиям.
  - Поиск вакансий с зарплатой выше средней.
  - Поиск вакансий по ключевому слову.
  - Удаление всех вакансий или компаний по выбору пользователя.

## Структура проекта
```
.
├── README.md
├── docker-compose.yml
├── main.py
├── requirements.txt
├── .env
├── src
│   ├── __init__.py
│   ├── config.py
│   ├── db_manager.py
│   ├── hh_api.py
│   └── saver.py
```
- `main.py` — основной скрипт для запуска приложения.
- `docker-compose.yml` — файл для настройки и запуска PostgreSQL через Docker.
- `requirements.txt` — список зависимостей проекта.
- `.env` — файл с переменными окружения (настройки базы данных и список компаний).
- `src/` — директория с модулями проекта:
  - `config.py` — загрузка конфигурации из `.env`.
  - `db_manager.py` — класс `DBManager` для работы с базой данных.
  - `hh_api.py` — класс `FromHHru` для взаимодействия с API hh.ru.
  - `saver.py` — класс `DBSaver` для сохранения данных в базу данных.

## Требования

- **Python** 3.8 или выше
- **PostgreSQL** (можно использовать Docker)
- **Библиотеки Python** из `requirements.txt`

## Установка и запуск

### 1. Клонирование репозитория

```bash
  git clone https://github.com/Ferrum76/KursovoyProject5
  cd KursovoyProject5
```

### 2. Создание виртуального окружения
Создайте и активируйте виртуальное окружение:

```bash
    # Создание виртуального окружения
    python3 -m venv venv
    
    # Активация (Windows)
    venv\Scripts\activate
    
    # Активация (Unix/MacOS)
    source venv/bin/activate
```

### 3. Установка зависимостей

```bash
  pip install -r req.txt
```

### 4. Настройка переменных окружения
Создайте файл .env в корневой директории проекта и добавьте следующие переменные:
``` 
    # Список компаний через запятую
    COMPANY_NAMES=Компания1, Компания2, Компания3, Компания4, Компания5, Компания6, Компания7, Компания8, Компания9, Компания10
    
    # Параметры подключения к базе данных
    DATABASE_USER=your_db_user
    DATABASE_PASSWORD=your_db_password
    DATABASE_HOST=localhost
    DATABASE_PORT=5432
    DATABASE_NAME=your_database_name
```

<i>Примечание</i>: Замените your_db_user, your_db_password и your_database_name на ваши реальные данные. Либо используйте переменные окружения как в docker-compose.yml.

### 5. Запуск базы данных
При использование Docker, запустите базу данных с помощью команды
```bash
  docker-compose up -d
```

Так же можно запустить базу данных на локальном компьютере, установив свои ENV переменные.

### 6. Запуск приложения
```bash
  python3 main.py
```

## Использование

```
  Добро пожаловать в интерактивный поиск вакансий на сайте hh.ru

    Выберите действие:
    1 - Загрузить вакансии в базу данных
    2 - Показать компании и количество вакансий
    3 - Показать все вакансии
    4 - Показать среднюю зарплату по вакансиям
    5 - Показать вакансии с зарплатой выше средней
    6 - Поиск вакансий по ключевому слову
    7 - Удалить все вакансии
    8 - Удалить все компании
    9 - Выход
```
Введите номер действия и следуйте инструкциям.

## Описание действий:
1. **Загрузить вакансии в базу данных**: Получает вакансии для указанных компаний и сохраняет их в базу данных.

2. **Показать компании и количество вакансий**: Выводит список компаний и количество вакансий у каждой.

3. **Показать все вакансии**: Выводит подробную информацию по всем вакансиям.

4. **Показать среднюю зарплату по вакансиям**: Вычисляет и выводит среднюю зарплату.

5. **Показать вакансии с зарплатой выше средней**: Выводит вакансии, где зарплата выше средней.

6. **Поиск вакансий по ключевому слову**: Позволяет искать вакансии по заданному ключевому слову.

7. **Удалить все вакансии**: Удаляет все вакансии из базы данных.

8. **Удалить все компании**: Удаляет все компании и связанные с ними вакансии из базы данных.

9. **Выход**: Завершение работы программы.

## Основные компоненты проекта:
`config.py`
Модуль для загрузки конфигурации из файла .env. Использует библиотеку dotenv для чтения переменных окружения.

`db_manager.py`
Класс DBManager отвечает за взаимодействие с базой данных PostgreSQL.Основные методы:
- `get_companies_and_vacancies_count()`
- `get_all_vacancies()`
- `get_avg_salary()`
- `get_vacancies_with_higher_salary()`
- `get_vacancies_with_keyword(keyword)`

`hh_api.py`
Класс FromHHru для взаимодействия с API hh.ru. Позволяет получать вакансии по ключевому слову или названию компании.

`saver.py`
Реализация абстрактного класса Saver:

- `DBSaver` использует `DBManager` для сохранения данных в базу данных.
- Методы для сохранения компаний и вакансий, а также для удаления данных.

## Настройка Docker
Файл docker-compose.yml содержит конфигурацию для запуска PostgreSQL в контейнере Docker.
```yaml
version: '3'
services:
  postgres:
    image: postgres:13
    environment:
      POSTGRES_HOST: localhost
      POSTGRES_PORT: 5432
      POSTGRES_USER: test
      POSTGRES_PASSWORD: test
      POSTGRES_DB: hhru_db
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```
*Примечание*: Переменные могут быть в виде `${DATABASE_USER}`, `${DATABASE_PASSWORD}`, `${DATABASE_NAME}` и др. - будут взяты из файла .env.

## Дополнительные сведения
- Обработка ошибок: Программа содержит обработку возможных исключений при работе с API и базой данных.
- Логирование: Можно добавить логирование для отслеживания работы приложения (по желанию).
- Расширяемость: Проект построен с использованием принципов ООП, что облегчает его расширение и модификацию.
- Автоматический запуск: Программа запускается только при первом запуске.
- Тестирование: Программа не содержит функциональные тесты, так как они отсутствуют в критериях приемки, но можно их добавить.
## Возможные проблемы и их решения
- Ошибка при подключении к базе данных:
- Проверьте правильность настроек в файле .env.
- Убедитесь, что база данных PostgreSQL запущена.
- ModuleNotFoundError при импорте модулей:
- Убедитесь, что вы запускаете main.py из корневой директории проекта.
- Проверьте, что в директории src присутствует файл __init__.py.
- Ошибка при создании базы данных:
- Убедитесь, что у пользователя базы данных есть права на создание базы `(CREATEDB)`.
- При использовании Docker база данных создается автоматически.
